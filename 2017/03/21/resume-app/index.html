<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--Favicon set-->
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/manifest.json">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="theme-color" content="#ffffff">

  <title>Dylan Huang | Resume Database Web App</title>
  <meta name="author" content="Dylan Huang">
  <meta name="description" content="Web enthusiast, Computer Engineer, Dog Lover">
  <meta property="og:title" content="Resume Database Web App | Dylan Huang">
  <meta property="og:url" content="dylanhuang.com/2017/03/21/resume-app/">
  <meta property="og:site_name" content="Dylan Huang">
  <meta property="og:description" content="Web enthusiast, Computer Engineer, Dog Lover">
  <meta property="og:image" content="/assets/image/resume-app.png">
  <meta property="og:type" content="blog">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:description" content="Web enthusiast, Computer Engineer, Dog Lover">
  <meta name="twitter:title" content="Resume Database Web App | Dylan Huang">
  <meta name="twitter:url" content="dylanhuang.com/2017/03/21/resume-app/">
  <meta name="twitter:site" content="Dylan Huang">
  <meta name="twitter:creator" content="@https://twitter.com/dhuangster">
  <meta name="twitter:domain" content="dylanhuang.com">
  <meta property="twitter:image" content="/assets/image/resume-app.png">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata|Lora|Space+Mono:700">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css">
  <link rel="stylesheet" href="/css/main.css">

  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/octicons/2.0.2/octicons.min.css">

  <link rel="stylesheet" href="https://cdn.rawgit.com/konpa/devicon/4f6a4b08efdad6bb29f9cc801f5c07e263b39907/devicon.min.css">

  <link rel="alternate" type="application/rss+xml" title="Dylan Huang" href="dylanhuang.com/feed.xml">
  <link rel="canonical" href="dylanhuang.com/2017/03/21/resume-app/">

  
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-82333002-2', 'auto');
      ga('send', 'pageview');
    </script>
  
</head>


  <body>

    <main>
      <article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="section-padding--lg mast">
    <a class="nav nav--white" href="/">
      <i class="fa fa-lg fa-arrow-left"></i>
      <span>Back</span>
    </a>
    <figure class="absolute-bg mast__img" style="background-image: url('/assets/image/resume-app.png');"></figure>
    <div class="mast__container">
      <span>
        <time datetime="2017-03-21T00:00:00-07:00" itemprop="datePublished">Mar 21, 2017</time>
        
        <i class="devicon-rails-plain-wordmark colored"></i>
        
        <i class="devicon-ruby-plain-wordmark colored"></i>
        
      </span>
      <h1 itemprop="name headline">Resume Database Web App</h1>
        <span>
          Champaign, Illinois
        </span>
      <span></span>
    </div>
  </header>

  <section class="section-padding post" itemprop="articleBody">
    <h2 id="background">Background</h2>
<hr />
<p>I will always take any opportunity that I can find to make a web app. 
So when I found out that my fraternity did not have a web accessible resume database, I
took the opportunity to make one myself.</p>

<h2 id="goalsfunctionalities">Goals/Functionalities</h2>
<hr />
<ul>
  <li>Friendly interface</li>
  <li>Persistent resume files on new deploys</li>
  <li>Resumes can be downloaded</li>
  <li>Only users with a code can sign up for an account</li>
  <li>Accounts
    <ul>
      <li>Roles ie. Brother, Admin, Employer
        <ul>
          <li>Brothers:
            <ul>
              <li>view other resumes that are not private</li>
              <li>upload own resume</li>
              <li>make own resume private</li>
            </ul>
          </li>
          <li>Admin:
            <ul>
              <li>see all resumes</li>
              <li>delete users</li>
              <li>change role of users</li>
            </ul>
          </li>
          <li>Employer:
            <ul>
              <li>see all resumes</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="technologies">Technologies</h2>
<hr />
<ul>
  <li><a href="https://github.com/rails/rails">rails</a> - Web Framework</li>
  <li><a href="https://github.com/thoughtbot/paperclip">paperclip</a> - File Attachments</li>
  <li><a href="https://github.com/plataformatec/devise">devise</a> - Authentication</li>
  <li><a href="https://github.com/elabs/pundit">pundit</a> - Authorization</li>
  <li>Amazon S3 - File Storage</li>
</ul>

<h3 id="accounts">Accounts</h3>
<hr />
<p>To begin, I needed to implement a complete account authentication and
authorization system. To do this, I used a <a href="https://github.com/RailsApps/rails-devise-pundit">boilerplate rails app</a> from github
that implements basic user controller actions, sign up/in flow, and role-based
authorization. I thought it would be a waste of my time to implement a complete
role-based authentication and authorization app when someone has already laid
the foundation of an app with that purpose. Why would I try to invent the wheel
again, right?</p>

<p>The next step would be to customize this app so that it had the roles that I
wanted as well as the code-based sign up functionality.</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/user.rb</span>
<span class="n">enum</span> <span class="ss">role: </span><span class="p">[</span><span class="ss">:employer</span><span class="p">,</span> <span class="ss">:brother</span><span class="p">,</span> <span class="ss">:admin</span><span class="p">]</span>
<span class="n">after_initialize</span> <span class="ss">:set_default_role</span><span class="p">,</span> <span class="ss">:if</span> <span class="o">=&gt;</span> <span class="ss">:new_record?</span>

<span class="k">def</span> <span class="nf">set_default_role</span>
  <span class="nb">self</span><span class="p">.</span><span class="nf">role</span> <span class="o">||=</span> <span class="ss">:brother</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Then I wanted to implement the code-based sign up so the first step was to put a
code in the secrets.yml file. For development, I simply just put in a two-letter
easy-to-type code. But for production, I planned on grabbing the secret code
from environment variables.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">development</span><span class="pi">:</span>
  <span class="na">brother_code</span><span class="pi">:</span> <span class="s">tt</span>
<span class="na">production</span><span class="pi">:</span>
  <span class="na">brother_code</span><span class="pi">:</span> <span class="s">&lt;%= ENV["BROTHER_CODE"] %&gt;</span>
</code></pre></div></div>

<p>After adding the code, the next step was to customize the logic for signing up.
The sign up action for devise is under the “create” function in the
registrations’ controller. To override the “create” function, I
had to first change some routes.</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/routes.rb</span>
<span class="c1"># Not sure why I need to skip the sessions controller</span>
<span class="c1"># but it fixed duplicate routes</span>
<span class="n">devise_for</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">skip: </span><span class="p">[</span><span class="ss">:registrations</span><span class="p">,</span> <span class="ss">:sessions</span><span class="p">]</span>
<span class="n">devise_for</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">controllers: </span><span class="p">{</span>
<span class="ss">registrations: </span><span class="s1">'my_devise/registrations'</span>
<span class="p">}</span>
</code></pre></div></div>

<p>To then override the devise registration controller action for “create”, I created a folder
called my_devise which would contain a registration controller that simply
extends the base registration controller and has an additional if-else statement
that checks the brother code in the Rails secret.yml file.</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># controllers/my_devise/registrations_controller.rb</span>
<span class="k">class</span> <span class="nc">MyDevise</span><span class="o">::</span><span class="no">RegistrationsController</span> <span class="o">&lt;</span> <span class="no">Devise</span><span class="o">::</span><span class="no">RegistrationsController</span>
  <span class="c1"># POST /resource</span>
   <span class="k">def</span> <span class="nf">create</span>
     <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">][</span><span class="ss">:code</span><span class="p">]</span> <span class="o">==</span> <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">secrets</span><span class="p">.</span><span class="nf">brother_code</span>
       <span class="k">super</span>
     <span class="k">else</span> 
       <span class="n">redirect_to</span> <span class="n">new_user_registration_path</span><span class="p">,</span> <span class="ss">:alert</span> <span class="o">=&gt;</span> <span class="s2">"Incorrect Code"</span>
     <span class="k">end</span>
   <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>And lastly, I had to add the brother code text field to the sign up.</p>
<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--views/devise/registrations/new.html.erb--&gt;</span>
...
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:code</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">password_field</span> <span class="ss">:code</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'form-control'</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
...
</code></pre></div></div>

<p>And voila! I now had the roles that I wanted and code-based sign up implemented.
And with the addition of pundit and some authorization logic put into
app/policies/UserPolicy.rb, I was able to implement the authorization of certain
pages based on roles.</p>

<h3 id="file-attachment">File Attachment</h3>
<hr />

<p>The next hard step was to implement file-attachments for each user. Fortunately,
there is an extremely convenient ruby gem called ‘paperclip’ that helps you add
a file to an already-existing model. This is easily done with a few lines of
code and one migration.</p>

<p>First I just had to add the paperclip gem to my Gemfile and then add these two
lines of code to my user model.</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/models/user.rb</span>
<span class="n">has_attached_file</span> <span class="ss">:document</span><span class="p">,</span> <span class="ss">styles: </span><span class="p">{</span><span class="ss">thumbnail: </span><span class="p">[</span><span class="s2">"40x40#"</span><span class="p">,</span> <span class="ss">:png</span><span class="p">]}</span>
<span class="n">validates_attachment</span> <span class="ss">:document</span><span class="p">,</span> <span class="ss">content_type: </span><span class="p">{</span> <span class="ss">content_type: </span><span class="s2">"application/pdf"</span> <span class="p">}</span>
</code></pre></div></div>

<p>And with a simple form, users can now just upload a pdf to the website!</p>
<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"user_document"</span><span class="nt">&gt;</span> <span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">document?</span> <span class="p">?</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">document_file_name</span><span class="p">.</span><span class="nf">to_s</span> <span class="p">:</span> <span class="s2">"Document"</span> <span class="cp">%&gt;</span> <span class="nt">&lt;/label&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">file_field</span> <span class="ss">:document</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'form-control'</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<h3 id="surviving-new-deployments">Surviving New Deployments</h3>
<hr />
<p>Now it was only until I actually pushed this deployment to production did I
realize that the files that are uploaded through paperclip don’t survive new
deployments! This was a big issue because if the website had to be updated and
everyone had already uploaded all their resumes, all the file storage would be lost
and everyone would have to re-upload their resume. Thankfully, paperclip has an
easy-to-do solution with their configuration to use Amazon S3 Buckets for file-storage
instead of locally cached files on the web-server itself.</p>

<p>To do this, all I had to add was this configuration to production.rb file:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/environments/production.rb</span>
<span class="c1"># Amazon S3 Bucket config</span>
<span class="n">config</span><span class="p">.</span><span class="nf">paperclip_defaults</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">storage: :s3</span><span class="p">,</span>
  <span class="ss">s3_credentials: </span><span class="p">{</span>
    <span class="ss">bucket: </span><span class="no">ENV</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="s1">'S3_BUCKET_NAME'</span><span class="p">),</span>
    <span class="ss">access_key_id: </span><span class="no">ENV</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="s1">'AWS_ACCESS_KEY_ID'</span><span class="p">),</span>
    <span class="ss">secret_access_key: </span><span class="no">ENV</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="s1">'AWS_SECRET_ACCESS_KEY'</span><span class="p">),</span>
    <span class="ss">s3_region: </span><span class="no">ENV</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="s1">'AWS_REGION'</span><span class="p">),</span>
  <span class="p">},</span>
  <span class="ss">s3_host_name: </span><span class="s2">"s3-</span><span class="si">#{</span><span class="no">ENV</span><span class="p">[</span><span class="s1">'AWS_REGION'</span><span class="p">]</span><span class="si">}</span><span class="s2">.amazonaws.com"</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="conclusion">Conclusion</h3>
<hr />
<p>Now aside from the specific additional routes, controller logic, and html.erb
code, this concludes a fairly complete implementation of a resume database that
can easily be deployed to Heroku!</p>

<p><a href="https://github.com/dphuang2/kappathetatau">Link to Github Repo</a></p>


  </section>

  <section class="profile">
    <div class="profile__card">
      <div class="profile__img">
        <figure class="absolute-bg" style="background-image: url('/assets/image/card.jpg');"></figure>
      </div>
      <div class="profile__container">
        <p>Web Apps, Vim, Computers, and Dogs. <br><i><span id="sj-quote">"Everything around you that you call life was made up by people that were no smarter than you and you can change it, you can influence it, you can build your own things that other people can use. Once you learn that, you'll never be the same again."</span></i> ~ Steve Jobs</p>
        
          <ul class="profile__social">
            
              <li><a class="fa fa-lg fa-envelope-o" href="mailto:dylan.p.huang@gmail.com"></a></li>
            
            
              <li><a class="fa fa-lg fa-github" href="https://github.com/dphuang2" target="_blank"></a></li>
            
              <li><a class="fa fa-lg fa-linkedin" href="https://www.linkedin.com/in/dphuang2" target="_blank"></a></li>
            
              <li><a class="fa fa-lg fa-youtube" href="https://www.youtube.com/user/Balphis/videos" target="_blank"></a></li>
            
              <li><a class="fa fa-lg fa-file-text-o" href="/DylanHuangResume.pdf" target="_blank"></a></li>
            
          </ul>
        
      </div>
    </div>
  </section>

</article>


  <section class="next">
    <a class="next__link" href="/2017/03/08/vim-setup/" style="background-image: url('/assets/image/myvimsetup.png');">
      <div class="next__container">
        <span>Read Next</span>
        <h2>Vim Addict</h2>
      </div>
    </a>
  </section>


    </main>

    <div id="gh-wrapper">
  <div id="feed"></div>
  <div id="gh-button">Github activity</div>
</div>
 

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mustache.js/0.7.2/mustache.min.js"></script>
<script type="text/javascript" src="/assets/js/github-activity.js"></script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script>
<script type="text/javascript" src="/assets/js/app.js"></script>



  </body>


</html>
